# Настройка HTTPS для локальной разработки

## Что было сделано

1. ✅ Включен HTTPS в `vite.config.js`
2. ✅ Обновлена конфигурация окружения для автоматического определения протокола

## Решение проблемы "неподдерживаемого протокола"

Если вы получаете ошибку "Протокол не поддерживается", используйте **mkcert** для создания доверенных локальных сертификатов.

### Вариант 1: Использование mkcert (РЕКОМЕНДУЕТСЯ)

#### Шаг 1: Установите mkcert

**Windows (с Chocolatey):**
```bash
choco install mkcert
```

**Windows (вручную):**
1. Скачайте последнюю версию с https://github.com/FiloSottile/mkcert/releases
2. Распакуйте `mkcert-v*-windows-amd64.exe` и переименуйте в `mkcert.exe`
3. Добавьте в PATH или поместите в папку проекта

**macOS:**
```bash
brew install mkcert
```

**Linux:**
```bash
# Ubuntu/Debian
sudo apt install libnss3-tools
# Затем скачайте бинарник с GitHub

# Или через snap
sudo snap install mkcert
```

#### Шаг 2: Установите локальный CA

```bash
mkcert -install
```

Это создаст локальный Certificate Authority (CA) и добавит его в доверенные корневые сертификаты вашей системы.

#### Шаг 3: Создайте сертификат для localhost

```bash
cd frontend
mkcert localhost 127.0.0.1 ::1
```

Это создаст два файла:
- `localhost-key.pem` (приватный ключ)
- `localhost.pem` (сертификат)

#### Шаг 4: Обновите vite.config.js

Замените `https: true` на:

```javascript
server: {
  port: 5173,
  host: true,
  https: {
    key: fs.readFileSync('./localhost-key.pem'),
    cert: fs.readFileSync('./localhost.pem'),
  },
  // ... остальная конфигурация
}
```

И добавьте импорт в начало файла:
```javascript
import fs from 'fs'
```

#### Шаг 5: Запустите dev-сервер

```bash
npm run dev
```

Теперь браузер будет доверять сертификату автоматически, без предупреждений!

### Вариант 2: Встроенный HTTPS Vite (если mkcert не работает)

Просто запустите:
```bash
npm run dev
```

### 2. Откройте браузер

Сервер теперь будет доступен по адресу: **https://localhost:5173**

### 3. Примите самоподписанный сертификат

Плагин `@vitejs/plugin-basic-ssl` создаст доверенный сертификат автоматически. При первом запуске:

1. Плагин создаст сертификат в папке `node_modules/.vite-plugin-basic-ssl/`
2. При первом открытии браузер может показать предупреждение о безопасности

**Chrome/Edge:**
- Нажмите "Дополнительно" (Advanced)
- Нажмите "Перейти на localhost (небезопасно)" (Proceed to localhost (unsafe))
- После первого принятия сертификат будет доверенным

**Firefox:**
- Нажмите "Дополнительно" (Advanced)
- Нажмите "Принять риск и продолжить" (Accept the Risk and Continue)

**Важно:** Плагин создает сертификаты с правильными протоколами TLS, что должно решить проблему "неподдерживаемого протокола".

## Проверка

После принятия сертификата:
- ✅ URL должен начинаться с `https://`
- ✅ В адресной строке может быть иконка "Небезопасно" - это нормально для localhost
- ✅ WebAuthn теперь должен работать!

## Если возникают проблемы

1. **Очистите кэш браузера** и попробуйте снова
2. **Проверьте консоль браузера** на наличие ошибок
3. **Убедитесь, что порт 5173 свободен**

## Альтернативный вариант (для доверенных сертификатов)

Если хотите использовать доверенный сертификат (без предупреждений браузера), можно использовать `mkcert`:

```bash
# Установите mkcert (требуется один раз)
# Windows: choco install mkcert
# macOS: brew install mkcert
# Linux: следуйте инструкциям на https://github.com/FiloSottile/mkcert

# Создайте локальный CA
mkcert -install

# Создайте сертификат для localhost
mkcert localhost 127.0.0.1 ::1

# Обновите vite.config.js для использования созданных сертификатов:
# server: {
#   https: {
#     key: fs.readFileSync('./localhost-key.pem'),
#     cert: fs.readFileSync('./localhost.pem'),
#   }
# }
```

Но для большинства случаев встроенный вариант Vite достаточен.

